#  گزارش نهایی تسک: تحلیل و اجرای PoC برای سیستم‌های Agentic تولید محتوای ویدیویی

### ۱. تحلیل چالش‌های کلیدی
بزرگ‌ترین چالش در ساخت این پروژه، هماهنگ کردن Agentها با یکدیگر است.

#### الف) چالش: ثبات کاراکتر (Consistency)

**مشکل اصلی:** Agentها در صحنه‌های مختلف جزئیات حیاتی کاراکتر (مثل لباس یا مو) را فراموش می‌کنند.

**راه‌حل‌های عملی:**
1.  **حافظه مشترک ثابت (Shared Memory Agent):** یک Agent مسئول ساختن یک پایگاه داده‌ی کوچک و ثابت از تمام جزئیات حیاتی کاراکتر است.
2.  **Agent بررسی ثبات (Checker Agent):** یک Agent داور که خروجی را با حافظه مقایسه می‌کند و تناقض را برطرف می‌سازد.

#### ب) چالش: ناهماهنگی زمانی

**مشکل اصلی:** ترتیب وقایع در داستان به‌هم می‌ریزد یا Agentها ناگهان مکان داستان را بدون منطق تغییر می‌دهند.

**راه‌حل‌های عملی:**
1.  **ربات برنامه‌ریز (Planner Agent) و مسیر اجباری:** یک Agent مدیر که ابتدا یک نقشه راه (Workflow) می‌کشد. برای مثال، Agentها از ابزارهایی مثل **LangGraph** استفاده می‌کنند تا مجبور باشند طبق این نقشه راه و مرحله به مرحله پیش بروند. 
2.  **استفاده از خلاصه Agent قبلی:** Agent جدید خلاصه‌ای از وضعیت نهایی Agent قبلی را دریافت می‌کند تا منطق داستان حفظ شود.

#### ج) چالش: مدیریت منابع و هزینه (با تأکید بر منطق صرفه‌جویی)

**مشکل اصلی:** درخواست‌های بدون کنترل به APIهای گران تولید ویدیو.

**راه‌حل‌های عملی:**
1.  **ربات ناظر بودجه (Budget Supervisor):** یک Agent مدیر مالی که برای هر کار گران، اجازه صادر می‌کند.
2.  **منطق تأییدیه سه‌گانه برای صرفه‌جویی:** قبل از انجام کار پرهزینه، سیستم باید از طریق Agent حافظه و Agent مدیر، **چند بار** تأییدیه ثبات و کیفیت بگیرد تا از هزینه بیهوده جلوگیری شود.
3.  **حافظه پنهان (Caching Agent):** ذخیره‌سازی Assetهای قابل استفاده مجدد برای جلوگیری از تولید دوباره.

#### د) چالش: سوءتفاهم Agentها (با تأکید بر ارتباط کدگونه)

**مشکل اصلی:** Agentها با زبان عادی خروجی می‌دهند که برای Agent بعدی مبهم است.

**راه‌حل‌های عملی:**
1.  **خروجی ساختاریافته (JSON Schema) به جای متن:** Agentها مجبور می‌شوند که خروجی‌های خود را فقط در قالب‌های منظم و **کدگونه (مثل JSON)** با فیلدهای دقیق (مانند `مکان`، `زمان`) ارائه دهند تا ابهام از بین برود.
2.  **Agent اعتبارسنجی ورودی:** Agentای که ساختار خروجی Agent قبلی را چک می‌کند تا مطمئن شود ساختار آن درست و قابل پردازش است.

---

### ۲. پیاده‌سازی عملی PoC و حل چالش (Character Consistency)

من روی حل چالش **ثبات کاراکتر** کار کردم.

* **رویکرد عملی:** من یک شبیه‌سازی در پایتون ایجاد کردم تا نشان دهم چگونه یک **Agent حافظه** و یک **ربات تأییدیه (Checker)** با هم کار می‌کنند.
* **اجرای منطق صرفه‌جویی:** سیستم ما، تنها پس از **تأییدیه ثبات (همان منطق تأییدیه سه‌گانه در شبیه‌سازی)**، اجازه تولید پرامپت نهایی (که بخش پرهزینه کار است) را صادر می‌کند.
* **نتیجه حل Edge Case:** سیستم با موفقیت، درخواست اشتباه در متن داستان ("لباس قرمز") را با ارجاع به حافظه مشترک، به **"زره آبی سنگین"** اصلاح کرد و ثبات کاراکتر را حفظ نمود.
